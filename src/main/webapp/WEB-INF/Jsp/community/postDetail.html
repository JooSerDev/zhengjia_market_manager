<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">

    <link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../bootstrap/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="../../bootstrap/css/bootstrap-table.min.css">

    <title>帖子详情</title>
    <style type="text/css">
        body {
            margin: 0px;
            padding: 0px;
            border-radius: 0;
        }
    </style>
</head>
<body>

<div class="panel-body" style="padding-bottom: 0px;">
    <div class="panel panel-primary">
        <div class="panel-heading">
            <h3 class="panel-title">宝贝信息</h3>
        </div>
        <div class="panel-body">
            <div id="toolbar">
                <div style="display: inline-block;margin-right: 50px">
                    <button class="btn btn-primary" id="forceToTop" style="margin-right:20px;" data-toggle="modal" data-target="#forceTotopModal">
                        置顶</button>
                    <button class="btn btn-default" id="cancleToTop" data-toggle="modal" data-target="#cancleToTopModal">
                        取消置顶</button>
                </div>
                <div style="display: inline-block;margin-right: 100px">
                    <button class="btn btn-primary" id="addEssence" style="margin-right:20px;" data-toggle="modal" data-target="#addEssenceModal">
                        加精</button>
                    <button class="btn btn-default" id="cancleEssence" data-target="#cancleEssenceModal" data-toggle="modal">
                        取消加精</button>
                </div>
                <div style="display: inline-block;margin-right: 100px">
                    <button class="btn btn-primary" id="removePostBtn" style="margin-right:20px;" data-toggle="modal" data-target="#removePostModal">
                        移帖</button>
                </div>
                <button class="btn btn-default" id="deletePost" data-toggle="modal" data-target="#deletePostModal">
                    删帖</button>
            </div>
            <table id="itemDetail" class="table table-bordered table-striped"></table>
            <div id="itemImgs" class="inline" style="margin-top: 10px;"></div>
        </div>
    </div>
</div>
<!-- 	<div class="well well-lg">期望交换物品： test</div> -->
<div class="panel-body" style="padding-top: 0px;">
    <div class="panel panel-primary">
        <div class="panel-heading">
            <h3 class="panel-title">宝贝所属用户信息</h3>
        </div>
        <div class="panel-body">
            <div class="form-horizontal">
                <div class="form-group">
                    <div class="col-md-4 col-sm-6 col-xs-6">
                        <p>
                            <label>用户名昵称：</label><span id="userNickName"></span>
                        </p>
                        <hr>
                        <p>
                            <label>用户手机号：</label><span id="userMobile"></span>
                        </p>
                    </div>
                    <div
                            class="col-md-4 col-offset-md-2 col-sm-4 col-xs-4 col-offset-sm-2 col-offset-xs-2">
                        <img id="userHeadImgUrl" onclick="showImg(this.src)"
                             width="100px;" height="100px">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="imgModal"
     style="width: auto; height: auto; margin-left: auto; margin-right: auto;">
    <div class="modal-dialog">
        <div class="modal-content"
             style="text-align: center; background-color: #ffffff">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
            </div>
            <img id="showImgLarge" height="200px" width="200px" align="center">
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="forceTotopModal" aria-hidden="true">
    <div class="modal-dialog" style="width: 400px; margin-top: 200px;">
        <div class="modal-content">
            <div class="modal-body">确认要置顶吗？</div>
            <div class="modal-footer">
                <button class="btn btn-default" id="forceToTopBtn">确定</button>
                <button class="btn btn-primary" data-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="cancleToTopModal" aria-hidden="true">
    <div class="modal-dialog" style="width: 400px; margin-top: 200px;">
        <div class="modal-content">
            <div class="modal-body">确认要取消置顶吗？</div>
            <div class="modal-footer">
                <button class="btn btn-default" id="cancleToTopBtn">确定</button>
                <button class="btn btn-primary" data-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="addEssenceModal" aria-hidden="true">
    <div class="modal-dialog" style="width: 400px; margin-top: 200px;">
        <div class="modal-content">
            <div class="modal-body">确认要加精吗？</div>
            <div class="modal-footer">
                <button class="btn btn-default" id="addEssenceBtn">确定</button>
                <button class="btn btn-primary" data-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="cancleEssenceModal" aria-hidden="true">
    <div class="modal-dialog" style="width: 400px; margin-top: 200px;">
        <div class="modal-content">
            <div class="modal-body">确认要取消加精吗？</div>
            <div class="modal-footer">
                <button class="btn btn-default" id="cancleEssenceBtn">确定</button>
                <button class="btn btn-primary" data-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="removePostModal" aria-hidden="true">
    <div class="modal-dialog" style="width: 400px; margin-top: 200px;">
        <div class="modal-content">
            <div class="modal-header">移帖至</div>
            <div class="modal-body" style="text-align: center">
                <select  id="removePostSelect" class="form-control" name="removePost" style="width: 150px;display: inline-block">
                </select>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" id="removePostButton">确定</button>
                <button class="btn btn-primary" data-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="deletePostModal" aria-hidden="true">
    <div class="modal-dialog" style="width: 400px; margin-top: 200px;">
        <div class="modal-content">
            <div class="modal-body">此操作不可恢复,确定要删除此贴吗?</div>
            <div class="modal-footer">
                <button class="btn btn-default" id="deletePostBtn">确定</button>
                <button class="btn btn-primary" data-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>


</body>

<script src="../../bootstrap/js/jquery.min.js"></script>
<script src="../../bootstrap/js/bootstrap.min.js"></script>
<script src="../../bootstrap/js/bootstrap-table.js"></script>
<script src="../../common/common.js"></script>
<!--[if lte IE 9]>
<script src="../../common/html5.js"></script>
<script src="../../common/respond.js"></script>
<![endif]-->


<script type="text/javascript">
    $(function() {
        initCurrentPage();
        initItemDetailTable();
        buttonInitFunc();
    });

    function initItemDetailTable() {
        var columns = [{
            field : 'itemId',
            align : 'center',
            valign : 'center',
            title : '用户',
        }, {
            field : 'name',
            align : 'center',
            valign : 'center',
            title : '类型',
        }, {
            field : 'approvalStatus',
            align : 'center',
            valign : 'center',
            title : '帖子标题',
        }, {
            field : 'lastModifyTime',
            align : 'center',
            valign : 'center',
            title : '社群',
        }, {
            field : 'ownerNickname',
            align : 'center',
            valign : 'center',
            title : '帖子分类',
        }, {
            field : 'itemTypeName',
            align : 'center',
            valign : 'center',
            title : '置顶',
        }, {
            field : 'status',
            align : 'center',
            valign : 'center',
            title : '精华',
        }, {
            field : 'isRecommended',
            align : 'center',
            valign : 'center',
            title : '发布者昵称',
        }, {
            field : 'lockStatus',
            align : 'center',
            valign : 'center',
            title : '发布时间',
        } ];

        var oTable = new TableInit("itemDetail", columns, null,'json/post.json',
                null, null,false,null);
        oTable.Init();

    }

    function initCurrentPage() {

        $.get('json/postItemClasses.json',function (data) {
            $.each(data,function (index,currentClass) {
                $("#removePostSelect").append('<option value=currentClass.value>'+currentClass.text+'</option>');
            })
        })

        //获取tabel的数据
        $.get('json/post.json',function (tdData) {

            var imgUrls = tdData.images;
            $.each(
                    imgUrls,
                    function(index, postImage) {
                        if (postImage.url != null && postImage.url != "") {
                            var img = '<img src="'
                                    + postImage.url
                                    + '" onclick="showImg(this.src)" width="100px" height="100px" style="margin-top:5px;margin-bottom:5px;margin-right:10px;"/>';
                            $("#itemImgs").append(img);
                        }
                    });

        })

        //获取用户信息
        $.get('json/userInfo.json',function (data) {
            console.log(data.userNickName);
            console.log(data.userMobile);
            $("#userNickName").html(data.userNickName);
            $("#userMobile").html(data.userMobile);
            $("#userHeadImgUrl").attr("src", data.userHeadImgUrl);
        })
    }

    function buttonInitFunc() {
        //置顶
        $("#forceToTopBtn").bind("click", function() {
            reloadPage("forceTotopModal");
        });
        //取消置顶
        $("#cancleToTopBtn").bind("click", function() {
            reloadPage("cancleToTopModal");
        });
        //加精
        $("#addEssenceBtn").bind("click", function() {
            reloadPage("addEssenceModal");
        });
        //取消加精
        $("#cancleEssenceBtn").bind("click", function() {
            reloadPage("cancleEssenceModal");
        });
        //移帖
        $("#removePostButton").bind("click", function() {

            var data = {
                itemType : $("#removePostSelect").val()
            }

            $.post('',data,function () {
                $('#itemDetail').bootstrapTable('refresh', {
                    url : 'json/post.json'
                });
            })
            $('#removePostModal').modal('hide')
        });
        //删帖
        $("#deletePostBtn").bind("click", function() {

            var data = {
                itemId : ''
            }

            $.post('',data,function () {

            })
            $('#deletePostModal').modal('hide')
        });
    }

    function reloadPage(modalId) {
        $.post('',function (data) {
            $('#itemDetail').bootstrapTable('refresh', {
                url : 'json/post.json'
            });
        })

        $('#' + modalId).modal('hide')
    }


</script>
</html>